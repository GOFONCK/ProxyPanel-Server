# Инструкция по подключению к прокси

## Ваша конфигурация:

- **Панель управления:** 178.158.227.243
  - Веб-панель: http://178.158.227.243:5000
  - HTTP прокси: 178.158.227.243:8080
  - SOCKS5 прокси: 178.158.227.243:8090
  - REST API: http://178.158.227.243:8000

- **Нода:** 130.49.178.94:1080

## Шаг 1: Настройка ноды

На сервере с IP 130.49.178.94:

1. Убедитесь, что `node_client.py` настроен правильно:
   ```python
   NODE_HOST = '130.49.178.94'  # IP этой ноды
   PANEL_HOST = '178.158.227.243'  # IP панели
   ```

2. Запустите ноду:
   ```bash
   python node_client.py
   ```

   Нода автоматически зарегистрируется в панели.

## Шаг 2: Добавление ноды в веб-панели

1. Откройте веб-панель: http://178.158.227.243:5000/login
   - Логин: `admin`
   - Пароль: `admin123`

2. Перейдите в раздел **"Ноды"**

3. Добавьте ноду с параметрами:
   - **ID ноды:** `node-001` (или любой уникальный ID)
   - **Название:** `Node 1` (или любое имя)
   - **IP/Хост:** `130.49.178.94`
   - **Порт:** `1080`
   - **Тип:** `SOCKS5`
   - **Токен:** `node_secret_token_123` (должен совпадать с AUTH_TOKEN в node_client.py)

4. Нажмите **"Добавить"**

## Шаг 3: Создание пользователя

1. Перейдите в раздел **"Пользователи"**

2. Добавьте пользователя:
   - **Логин:** например `user1`
   - **Пароль:** например `pass1`
   - **Лимит устройств:** например `5`

3. Нажмите **"Добавить"**

## Шаг 4: Назначение ноды пользователю

1. Перейдите в раздел **"Назначения"**

2. Выберите:
   - **Пользователь:** `user1`
   - **Нода:** `Node 1` (130.49.178.94)

3. Нажмите **"Назначить"**

## Шаг 5: Подключение к прокси

Теперь вы можете подключиться к прокси используя учетные данные пользователя.

### Вариант 1: HTTP прокси

**Настройки прокси:**
- Адрес: `178.158.227.243`
- Порт: `8080`
- Тип: HTTP
- Аутентификация: Basic Auth
  - Логин: `user1`
  - Пароль: `pass1`

**Примеры использования:**

**cURL:**
```bash
curl -x http://user1:pass1@178.158.227.243:8080 https://api.ipify.org
```

**Браузер (Chrome/Firefox):**
1. Настройки → Сеть → Прокси
2. Ручная настройка прокси
3. HTTP прокси: `178.158.227.243:8080`
4. Использовать этот прокси-сервер для всех протоколов: ✅
5. Введите логин и пароль при запросе

**Python:**
```python
import requests

proxies = {
    'http': 'http://user1:pass1@178.158.227.243:8080',
    'https': 'http://user1:pass1@178.158.227.243:8080'
}

response = requests.get('https://api.ipify.org', proxies=proxies)
print(response.text)  # Должен показать IP ноды: 130.49.178.94
```

### Вариант 2: SOCKS5 прокси

**Настройки прокси:**
- Адрес: `178.158.227.243`
- Порт: `8090`
- Тип: SOCKS5
- Аутентификация: Username/Password
  - Логин: `user1`
  - Пароль: `pass1`

**Примеры использования:**

**cURL:**
```bash
curl --socks5-hostname user1:pass1@178.158.227.243:8090 https://api.ipify.org
```

**Python:**
```python
import requests
import socks
import socket

socks.set_default_proxy(socks.SOCKS5, "178.158.227.243", 8090, username="user1", password="pass1")
socket.socket = socks.socksocket

response = requests.get('https://api.ipify.org')
print(response.text)  # Должен показать IP ноды: 130.49.178.94
```

**Браузер (через расширение):**
- Firefox: FoxyProxy
- Chrome: SwitchyOmega

### Вариант 3: REST API

**Получение токена:**
```bash
curl -X POST http://178.158.227.243:8000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username": "user1", "password": "pass1"}'
```

Ответ:
```json
{
  "message": "Login successful",
  "token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "proxy_address": "0.0.0.0",
  "http_port": 8080,
  "socks5_port": 8090,
  "assigned_nodes": [{"node_id": "node-001", "name": "Node 1"}]
}
```

## Проверка работы

После подключения проверьте ваш IP:

```bash
# Через HTTP прокси
curl -x http://user1:pass1@178.158.227.243:8080 https://api.ipify.org

# Через SOCKS5 прокси
curl --socks5-hostname user1:pass1@178.158.227.243:8090 https://api.ipify.org
```

**Ожидаемый результат:** IP должен быть `130.49.178.94` (IP вашей ноды)

## Устранение проблем

### Нода не подключается к панели

1. Проверьте, что панель запущена: `python panel_server.py`
2. Проверьте файрвол на панели (порт 3333 должен быть открыт)
3. Проверьте логи ноды на наличие ошибок

### Прокси не работает

1. Убедитесь, что нода запущена на 130.49.178.94
2. Проверьте, что нода зарегистрирована в панели (раздел "Ноды")
3. Проверьте, что нода назначена пользователю (раздел "Назначения")
4. Проверьте, что нода активна (зеленый статус в веб-панели)
5. Проверьте файрвол на ноде (порт 1080 должен быть открыт)

### Неправильный IP

Если вы видите IP панели вместо IP ноды:
- Убедитесь, что нода запущена и активна
- Проверьте логи панели на наличие ошибок подключения к ноде
- Убедитесь, что нода правильно зарегистрирована с правильным IP

## Безопасность

⚠️ **Важно:**
- Смените пароль администратора в `web_panel.py`
- Смените `JWT_SECRET` в `panel_server.py`
- Используйте сильные токены для нод
- Настройте файрвол для защиты портов
- Используйте HTTPS для веб-панели в продакшене

